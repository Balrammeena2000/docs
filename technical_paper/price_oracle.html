<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Asset Price Oracle</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="Build Your Own Staking Economy">
    <link rel="preload" href="/assets/css/0.styles.f317dd00.css" as="style"><link rel="preload" href="/assets/js/app.95bbd6c3.js" as="script"><link rel="preload" href="/assets/js/2.e08193f9.js" as="script"><link rel="preload" href="/assets/js/39.1dd19c7b.js" as="script"><link rel="prefetch" href="/assets/js/10.d8ca8058.js"><link rel="prefetch" href="/assets/js/11.b5984e93.js"><link rel="prefetch" href="/assets/js/12.e9659f9f.js"><link rel="prefetch" href="/assets/js/13.82e3658c.js"><link rel="prefetch" href="/assets/js/14.35ac129b.js"><link rel="prefetch" href="/assets/js/15.88c73b09.js"><link rel="prefetch" href="/assets/js/16.eafe6836.js"><link rel="prefetch" href="/assets/js/17.fb5dfa13.js"><link rel="prefetch" href="/assets/js/18.2149fdea.js"><link rel="prefetch" href="/assets/js/19.801a6c02.js"><link rel="prefetch" href="/assets/js/20.c173d47a.js"><link rel="prefetch" href="/assets/js/21.b27f4d05.js"><link rel="prefetch" href="/assets/js/22.a2fcd7fe.js"><link rel="prefetch" href="/assets/js/23.5a1095e9.js"><link rel="prefetch" href="/assets/js/24.b3528214.js"><link rel="prefetch" href="/assets/js/25.af34d725.js"><link rel="prefetch" href="/assets/js/26.39582bd8.js"><link rel="prefetch" href="/assets/js/27.a959cd0c.js"><link rel="prefetch" href="/assets/js/28.ba71a2db.js"><link rel="prefetch" href="/assets/js/29.01f596f9.js"><link rel="prefetch" href="/assets/js/3.cdfcedae.js"><link rel="prefetch" href="/assets/js/30.91f51ffb.js"><link rel="prefetch" href="/assets/js/31.c131116e.js"><link rel="prefetch" href="/assets/js/32.27276152.js"><link rel="prefetch" href="/assets/js/33.a4385887.js"><link rel="prefetch" href="/assets/js/34.1463187a.js"><link rel="prefetch" href="/assets/js/35.6d46379f.js"><link rel="prefetch" href="/assets/js/36.9fcd6b2f.js"><link rel="prefetch" href="/assets/js/37.fdc3a364.js"><link rel="prefetch" href="/assets/js/38.eec0ac62.js"><link rel="prefetch" href="/assets/js/4.d9591209.js"><link rel="prefetch" href="/assets/js/40.b84228f1.js"><link rel="prefetch" href="/assets/js/41.a0f82bcc.js"><link rel="prefetch" href="/assets/js/42.f22cf023.js"><link rel="prefetch" href="/assets/js/43.a2fe2d43.js"><link rel="prefetch" href="/assets/js/44.31367d06.js"><link rel="prefetch" href="/assets/js/45.bd3b48f0.js"><link rel="prefetch" href="/assets/js/46.58623a36.js"><link rel="prefetch" href="/assets/js/47.6a43a47b.js"><link rel="prefetch" href="/assets/js/48.7de9ec08.js"><link rel="prefetch" href="/assets/js/49.690b1484.js"><link rel="prefetch" href="/assets/js/5.8b3b99fd.js"><link rel="prefetch" href="/assets/js/50.58510936.js"><link rel="prefetch" href="/assets/js/51.5d46807c.js"><link rel="prefetch" href="/assets/js/52.e2641a2f.js"><link rel="prefetch" href="/assets/js/53.d5895bf1.js"><link rel="prefetch" href="/assets/js/6.f26b2dfe.js"><link rel="prefetch" href="/assets/js/7.9caebd06.js"><link rel="prefetch" href="/assets/js/8.090cb55e.js"><link rel="prefetch" href="/assets/js/9.5260492b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f317dd00.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.svg" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/white_paper/" class="nav-link">
  White Paper
</a></div><div class="nav-item"><a href="/technical_paper/" class="nav-link router-link-active">
  Technical Paper
</a></div><div class="nav-item"><a href="/lite_paper_v1/" class="nav-link">
  Peanut Lite Paper
</a></div><div class="nav-item"><a href="/donut/" class="nav-link">
  Donut
</a></div> <a href="https://github.com/nutbox-dao/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/white_paper/" class="nav-link">
  White Paper
</a></div><div class="nav-item"><a href="/technical_paper/" class="nav-link router-link-active">
  Technical Paper
</a></div><div class="nav-item"><a href="/lite_paper_v1/" class="nav-link">
  Peanut Lite Paper
</a></div><div class="nav-item"><a href="/donut/" class="nav-link">
  Donut
</a></div> <a href="https://github.com/nutbox-dao/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/technical_paper/background.html" class="sidebar-link">Background</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technical_paper/background.html#nutbox-contracts" class="sidebar-link">Nutbox Contracts</a></li><li class="sidebar-sub-header"><a href="/technical_paper/background.html#nutbox-parachain" class="sidebar-link">Nutbox Parachain</a></li></ul></li><li><a href="/technical_paper/ocsp.html" class="sidebar-link">Open Community Staking Protocol(OCSP) Contract</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technical_paper/ocsp.html#contract-topology" class="sidebar-link">Contract Topology</a></li><li class="sidebar-sub-header"><a href="/technical_paper/ocsp.html#multi-chain-ttoken" class="sidebar-link">Multi-Chain tToken</a></li><li class="sidebar-sub-header"><a href="/technical_paper/ocsp.html#community-token-ctoken-mining-distribution" class="sidebar-link">Community Token(cToken) Mining &amp; Distribution</a></li></ul></li><li><a href="/technical_paper/bridge.html" class="sidebar-link">Crosschain Bridge</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technical_paper/bridge.html#what-is-crosschain-bridge" class="sidebar-link">What Is Crosschain Bridge</a></li><li class="sidebar-sub-header"><a href="/technical_paper/bridge.html#light-trustless-blokchain-state-verification-ltbsv" class="sidebar-link">Light Trustless Blokchain State Verification(LTBSV)</a></li></ul></li><li><a href="/technical_paper/parachain.html" class="sidebar-link">Nutbox As Parachain</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technical_paper/parachain.html#nutbox-collator" class="sidebar-link">Nutbox Collator</a></li><li class="sidebar-sub-header"><a href="/technical_paper/parachain.html#xcm-based-transfer" class="sidebar-link">XCM Based Transfer</a></li></ul></li><li><a href="/technical_paper/price_oracle.html" class="active sidebar-link">Asset Price Oracle</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technical_paper/price_oracle.html#price-oracle-algorithm" class="sidebar-link">Price Oracle Algorithm</a></li><li class="sidebar-sub-header"><a href="/technical_paper/price_oracle.html#offchain-worker-based-price-oracle-flow" class="sidebar-link">Offchain Worker Based Price Oracle Flow</a></li></ul></li><li><a href="/technical_paper/governance_contracts.html" class="sidebar-link">Nutbox Governance Contracts</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technical_paper/governance_contracts.html#democracy" class="sidebar-link">Democracy</a></li><li class="sidebar-sub-header"><a href="/technical_paper/governance_contracts.html#collective" class="sidebar-link">Collective</a></li><li class="sidebar-sub-header"><a href="/technical_paper/governance_contracts.html#elections" class="sidebar-link">Elections</a></li><li class="sidebar-sub-header"><a href="/technical_paper/governance_contracts.html#membership" class="sidebar-link">Membership</a></li><li class="sidebar-sub-header"><a href="/technical_paper/governance_contracts.html#treasury" class="sidebar-link">Treasury</a></li><li class="sidebar-sub-header"><a href="/technical_paper/governance_contracts.html#multisig" class="sidebar-link">Multisig</a></li><li class="sidebar-sub-header"><a href="/technical_paper/governance_contracts.html#sudo" class="sidebar-link">Sudo</a></li></ul></li><li><a href="/technical_paper/references.html" class="sidebar-link">References</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="asset-price-oracle"><a href="#asset-price-oracle" class="header-anchor">#</a> Asset Price Oracle</h1> <h2 id="price-oracle-algorithm"><a href="#price-oracle-algorithm" class="header-anchor">#</a> Price Oracle Algorithm</h2> <p>From the above, we can see that there are various types of Assets. In this chapter, we will only discuss the price of Fungible Asset.</p> <p>The price acquisition oracle has always been a branch of technology that is worth exploring in the industry. It usually includes two stages: price calculation and price feed. There are many implementations that can meet basic business needs. Nutbox refers to Uniswap's Price Oracle implementation for asset price acquisition [7] . For general assets such as BTC and ETH, we can derive the price of the corresponding asset through Uniswap trading pairs. Since trading pairs in Uniswap have a constant product K , each trading pair can be finally deduced as a trading pair relative to USDT.</p> <p>Therefore, the asset price can be expressed as:</p> <p><img src="http://wherein.mobi/wp-content/uploads/2021/03/1.png" alt="Image text"></p> <p>The asset balance can be expressed as:</p> <p><img src="http://wherein.mobi/wp-content/uploads/2021/03/2.png" alt="Image text"></p> <p>Create a trading pair,</p> <p><img src="http://wherein.mobi/wp-content/uploads/2021/05/peanut3.png" alt="Image text"></p> <p>Nutbox not only supports the staking of general assets, but also the staking of LP tokens. LP token staking relies on the price oracle of LP token, and the price acquisition of LP token in the realization of the price oracle has certain peculiarities. Usually the price calculation of LP token can be expressed as:</p> <p><img src="http://wherein.mobi/wp-content/uploads/2021/03/4.png" alt="Image text"></p> <p>In the formula, r0 and r1 are the quantities of the two assets in Uniswap's corresponding trading pair, and price0 and price1 correspond to the prices of the tokens represented by r0 and r1 .The above formula is simply to calculate the sum of the total value of the two tokens in the trading pair, and then divide it by the total number of LP Tokens to get the price of LP tokens. In practice, this price calculation method is easy to be attacked by hackers, because hackers can easily manipulate r0 and r1 through trading pool transactions. Therefore, referring to Alpha Finance's LP Token price acquisition algorithm [9] , a better LP Token price acquisition algorithm can be expressed as:</p> <p><img src="http://wherein.mobi/wp-content/uploads/2021/03/5.png" alt="Image text"></p> <p>It can be seen from the above formula that the consequences of hackers' attacks on r0 and r1 are reduced from r0 + r1 to sqrt{r0} + sqrt{r1} . This algorithm realizes the constant product K of the trading pair curve based on Uniswap, so it is only applicable to the price calculation of the trading pair LP Token based on this trading model.</p> <h2 id="offchain-worker-based-price-oracle-flow"><a href="#offchain-worker-based-price-oracle-flow" class="header-anchor">#</a> Offchain Worker Based Price Oracle Flow</h2> <p>The current substrate provides the Offchain Worker [10] mechanism, which allows nodes to obtain external data through http and perform complex calculations such as encryption and decryption. Offchain Worker has Offchain Storage, which can be accessed directly by runtime, and other pallets can be accessed in Offchain Worker's pallet. At the same time, Offchain Worker can also submit data that requires consensus verification through Signed Transaction and Unsigned Transaction.</p> <p>The price oracle based on the Offchain Worker module uses the http protocol to obtain price information from a third-party price provider, calculates the asset price according to the price calculation algorithm, and then submits the price to the Nutbox network.</p> <p><img src="http://wherein.mobi/wp-content/uploads/2021/03/OCW-Based-Price-Fetcher-Flow.png" alt="Image text"></p> <p>Figure6, Offchain Worker Based Price Oracle Flow</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/nutbox-dao/docs/edit/master/book/technical_paper/price_oracle.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/4/2021, 3:59:10 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/technical_paper/parachain.html" class="prev">
        Nutbox As Parachain
      </a></span> <span class="next"><a href="/technical_paper/governance_contracts.html">
        Nutbox Governance Contracts
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.95bbd6c3.js" defer></script><script src="/assets/js/2.e08193f9.js" defer></script><script src="/assets/js/39.1dd19c7b.js" defer></script>
  </body>
</html>
