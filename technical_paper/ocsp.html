<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Open Community Staking Protocol(OCSP) Contract</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="Build Your Own Staking Economy">
    <link rel="preload" href="/assets/css/0.styles.f317dd00.css" as="style"><link rel="preload" href="/assets/js/app.b699af6d.js" as="script"><link rel="preload" href="/assets/js/2.e08193f9.js" as="script"><link rel="preload" href="/assets/js/37.fdc3a364.js" as="script"><link rel="prefetch" href="/assets/js/10.a510691b.js"><link rel="prefetch" href="/assets/js/11.83ad51dd.js"><link rel="prefetch" href="/assets/js/12.443d859a.js"><link rel="prefetch" href="/assets/js/13.bcc5bd0e.js"><link rel="prefetch" href="/assets/js/14.35ac129b.js"><link rel="prefetch" href="/assets/js/15.bb4ee28a.js"><link rel="prefetch" href="/assets/js/16.88ccd575.js"><link rel="prefetch" href="/assets/js/17.d0aeec5c.js"><link rel="prefetch" href="/assets/js/18.54260d67.js"><link rel="prefetch" href="/assets/js/19.8587a549.js"><link rel="prefetch" href="/assets/js/20.47d6a4b8.js"><link rel="prefetch" href="/assets/js/21.92de0e6b.js"><link rel="prefetch" href="/assets/js/22.731fb353.js"><link rel="prefetch" href="/assets/js/23.5a1095e9.js"><link rel="prefetch" href="/assets/js/24.b3528214.js"><link rel="prefetch" href="/assets/js/25.af34d725.js"><link rel="prefetch" href="/assets/js/26.39582bd8.js"><link rel="prefetch" href="/assets/js/27.a959cd0c.js"><link rel="prefetch" href="/assets/js/28.ba71a2db.js"><link rel="prefetch" href="/assets/js/29.01f596f9.js"><link rel="prefetch" href="/assets/js/3.cdfcedae.js"><link rel="prefetch" href="/assets/js/30.91f51ffb.js"><link rel="prefetch" href="/assets/js/31.c131116e.js"><link rel="prefetch" href="/assets/js/32.27276152.js"><link rel="prefetch" href="/assets/js/33.a4385887.js"><link rel="prefetch" href="/assets/js/34.1463187a.js"><link rel="prefetch" href="/assets/js/35.6d46379f.js"><link rel="prefetch" href="/assets/js/36.9fcd6b2f.js"><link rel="prefetch" href="/assets/js/38.eec0ac62.js"><link rel="prefetch" href="/assets/js/39.1dd19c7b.js"><link rel="prefetch" href="/assets/js/4.d9591209.js"><link rel="prefetch" href="/assets/js/40.b84228f1.js"><link rel="prefetch" href="/assets/js/41.a0f82bcc.js"><link rel="prefetch" href="/assets/js/42.f22cf023.js"><link rel="prefetch" href="/assets/js/43.a2fe2d43.js"><link rel="prefetch" href="/assets/js/44.31367d06.js"><link rel="prefetch" href="/assets/js/45.bd3b48f0.js"><link rel="prefetch" href="/assets/js/46.58623a36.js"><link rel="prefetch" href="/assets/js/47.6a43a47b.js"><link rel="prefetch" href="/assets/js/48.7de9ec08.js"><link rel="prefetch" href="/assets/js/49.690b1484.js"><link rel="prefetch" href="/assets/js/5.8b3b99fd.js"><link rel="prefetch" href="/assets/js/50.58510936.js"><link rel="prefetch" href="/assets/js/51.5d46807c.js"><link rel="prefetch" href="/assets/js/52.e2641a2f.js"><link rel="prefetch" href="/assets/js/53.d5895bf1.js"><link rel="prefetch" href="/assets/js/6.f26b2dfe.js"><link rel="prefetch" href="/assets/js/7.9caebd06.js"><link rel="prefetch" href="/assets/js/8.090cb55e.js"><link rel="prefetch" href="/assets/js/9.5260492b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f317dd00.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.svg" alt="" class="logo"> <!----></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/white_paper/" class="nav-link">
  White Paper
</a></div><div class="nav-item"><a href="/technical_paper/" class="nav-link router-link-active">
  Technical Paper
</a></div><div class="nav-item"><a href="/lite_paper_v1/" class="nav-link">
  Peanut Lite Paper
</a></div><div class="nav-item"><a href="/donut/" class="nav-link">
  Donut
</a></div> <a href="https://github.com/nutbox-dao/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/white_paper/" class="nav-link">
  White Paper
</a></div><div class="nav-item"><a href="/technical_paper/" class="nav-link router-link-active">
  Technical Paper
</a></div><div class="nav-item"><a href="/lite_paper_v1/" class="nav-link">
  Peanut Lite Paper
</a></div><div class="nav-item"><a href="/donut/" class="nav-link">
  Donut
</a></div> <a href="https://github.com/nutbox-dao/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/technical_paper/background.html" class="sidebar-link">Background</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technical_paper/background.html#nutbox-contracts" class="sidebar-link">Nutbox Contracts</a></li><li class="sidebar-sub-header"><a href="/technical_paper/background.html#nutbox-parachain" class="sidebar-link">Nutbox Parachain</a></li></ul></li><li><a href="/technical_paper/ocsp.html" class="active sidebar-link">Open Community Staking Protocol(OCSP) Contract</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technical_paper/ocsp.html#contract-topology" class="sidebar-link">Contract Topology</a></li><li class="sidebar-sub-header"><a href="/technical_paper/ocsp.html#multi-chain-ttoken" class="sidebar-link">Multi-Chain tToken</a></li><li class="sidebar-sub-header"><a href="/technical_paper/ocsp.html#community-token-ctoken-mining-distribution" class="sidebar-link">Community Token(cToken) Mining &amp; Distribution</a></li></ul></li><li><a href="/technical_paper/bridge.html" class="sidebar-link">Crosschain Bridge</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technical_paper/bridge.html#what-is-crosschain-bridge" class="sidebar-link">What Is Crosschain Bridge</a></li><li class="sidebar-sub-header"><a href="/technical_paper/bridge.html#light-trustless-blokchain-state-verification-ltbsv" class="sidebar-link">Light Trustless Blokchain State Verification(LTBSV)</a></li></ul></li><li><a href="/technical_paper/parachain.html" class="sidebar-link">Nutbox As Parachain</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technical_paper/parachain.html#nutbox-collator" class="sidebar-link">Nutbox Collator</a></li><li class="sidebar-sub-header"><a href="/technical_paper/parachain.html#xcm-based-transfer" class="sidebar-link">XCM Based Transfer</a></li></ul></li><li><a href="/technical_paper/price_oracle.html" class="sidebar-link">Asset Price Oracle</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technical_paper/price_oracle.html#price-oracle-algorithm" class="sidebar-link">Price Oracle Algorithm</a></li><li class="sidebar-sub-header"><a href="/technical_paper/price_oracle.html#offchain-worker-based-price-oracle-flow" class="sidebar-link">Offchain Worker Based Price Oracle Flow</a></li></ul></li><li><a href="/technical_paper/governance_contracts.html" class="sidebar-link">Nutbox Governance Contracts</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/technical_paper/governance_contracts.html#democracy" class="sidebar-link">Democracy</a></li><li class="sidebar-sub-header"><a href="/technical_paper/governance_contracts.html#collective" class="sidebar-link">Collective</a></li><li class="sidebar-sub-header"><a href="/technical_paper/governance_contracts.html#elections" class="sidebar-link">Elections</a></li><li class="sidebar-sub-header"><a href="/technical_paper/governance_contracts.html#membership" class="sidebar-link">Membership</a></li><li class="sidebar-sub-header"><a href="/technical_paper/governance_contracts.html#treasury" class="sidebar-link">Treasury</a></li><li class="sidebar-sub-header"><a href="/technical_paper/governance_contracts.html#multisig" class="sidebar-link">Multisig</a></li><li class="sidebar-sub-header"><a href="/technical_paper/governance_contracts.html#sudo" class="sidebar-link">Sudo</a></li></ul></li><li><a href="/technical_paper/references.html" class="sidebar-link">References</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="open-community-staking-protocol-ocsp-contract"><a href="#open-community-staking-protocol-ocsp-contract" class="header-anchor">#</a> Open Community Staking Protocol(OCSP) Contract</h1> <p>OCSP is a standard set of contract templates for deploying a user's asset staking business. With the OCSP contract, a tToken-based asset exchange gateway and a cToken distributor are created, that is, the business logic for users to exchange underlying assets and tTokens, as well as obtain cToken income through tToken-based staking. Here, both tToken and cToken represent two asset categories in the Nutbox network and do not refer to a specific asset.</p> <h2 id="contract-topology"><a href="#contract-topology" class="header-anchor">#</a> Contract Topology</h2> <p><img src="http://wherein.mobi/wp-content/uploads/2021/03/contract-topology.png" alt="Image text"></p> <p>Figure3, Contract Topology</p> <p>As shown in the figure above, OCSP is mainly composed of four main modules: Registration, StakingTemplate, StakingFactory, and BridgeProxy.</p> <ul><li><p>Registration
Registration contract is used by individuals or organizations to submit registration information to Nutbox.</p></li> <li><p>StakingTemplate
StakingTemplate contract contains the tToken-based staking economic model implemented by Nutbox. With this contract template, it is possible to create a staking tToken or provide liquidity for tToken-cToken trading pairs to mine cToken staking business.</p></li> <li><p>StakingFactory
StakingFactory contract is used to generate the StakingTemplate instances.</p></li> <li><p>BridgeProxy
BridgeProxy contract varies according to the implementation of the blockchain network. In a blockchain network that supports smart contracts, it will be implemented through smart contracts. For example, in the Ethereum network it is a Solidity contract, while in the Steem network it is just an account in the Steem network. It is primarily used by cross-chain Bridges to capture Nutbox-related asset transfer behavior in the original blockchain network.</p></li></ul> <h2 id="multi-chain-ttoken"><a href="#multi-chain-ttoken" class="header-anchor">#</a> Multi-Chain tToken</h2> <p>On Nutbox, users stake the assets of the original PoS blockchain network to obtain the corresponding tTokens in the Nutbox network, which are exchanged 1:1 with the underlying assets. For example, a user in the Nutbox network can exchange DOT holdings for tDOT, which can participate in the Nutbox staking mining of all Polkadot ecological projects, i.e., stake tDOT to obtain the corresponding community's cTokens. Nutbox will combine cross-chain bridge technology and Polkadot XCM to support asset exchange across multiple PoS blockchain networks.</p> <h3 id="ttoken-exchange-gateway（teg）"><a href="#ttoken-exchange-gateway（teg）" class="header-anchor">#</a> tToken Exchange Gateway（TEG）</h3> <p>TEG contract (Nutbox is deployed as a contract) and TEG pallet [5] (Nutbox is used as Polkadot Parachain) are responsible for implementing the cross-chain asset exchange gateway of the Nutbox network.</p> <p><img src="http://wherein.mobi/wp-content/uploads/2021/03/tToken-exchange-gateway.png" alt="Image text"></p> <p>Figure4, tToken Exchange Gateway</p> <p>As shown in the figure above, when a user exchanges a native asset for tToken, the native asset will be locked in the TEG Contract, and LTBSV verifies that if the user's asset is locked [shown in the Deposit proof section for details], when the verification is passed,it will generate a corresponding amount of tToken to the user In the Nutbox account; the TEG contract verifies the user’s tToken burning status when the user redeems it [shown in the tToken Burning Contract section for details], and when the verification is passed, the user’s native assets locked in the TEG Contract will be unlocked.</p> <h3 id="bridge-proxy-contract"><a href="#bridge-proxy-contract" class="header-anchor">#</a> Bridge Proxy Contract</h3> <p>The bridge proxy contract is a smart contract deployed by Nutbox to the original blockchain network and is responsible for storing and transferring assets in the original blockchain network. Asset transfer is completely decentralized. Anyone who needs to transfer assets from Proxy Contract needs to provide Withdraw proof. After verification, you can transfer assets from the contract to your own account.</p> <h3 id="ttoken-issue-contract"><a href="#ttoken-issue-contract" class="header-anchor">#</a> tToken Issue Contract</h3> <p>The issuance of tToken requires the user to provide a deposit proof [shown in 4.2.3]. The deposit proof is issued by the LTBSV to the user when the user deposits the original blockchain assets into the Nutbox proxy contract. After the user submits the Deposit proof, TEG's tToken Issue Contract verifies the signature information of the Deposit proof firstly, and the verified Deposit proof is parsed as Deposit MetaData, which contains the amount of the original blockchain assets staked by the user. TEG's tToken Issue Contract then issues the corresponding amount of tToken, and the exchange gateway creates a tToken Issurance Pair for this , which contains the amount of tToken issued, the user's public key, and the unlock time. The tTokens in the lock-up period cannot be exchanged for tokens in the original blockchain network.</p> <p><img src="http://wherein.mobi/wp-content/uploads/2021/03/tToken-issue.png" alt="Image text"></p> <p>Figure5, tToken Issurance</p> <h3 id="ttoken-burning-contract"><a href="#ttoken-burning-contract" class="header-anchor">#</a> tToken Burning Contract</h3> <p>When the unlocking time is reached, users can choose to redeem their unlocked tTokens at any time (users who use tTokens to participate in community token mining on Nutbox will also be locked). After the user chooses to burn a certain amount of tToken, TEG’s tToken Burning Contract will burn the same amount of tToken, and Nutbox will issue a Withdraw proof to the user. The proxy contract will verify the Withdraw proof signature information. After the verification is passed, the Withdraw MetaData will be parsed out, which contains the amount of tTokens that the user needs to unlock and the user's public key in the original blockchain. Then, the proxy contract transfers the specified amount of original blockchain assets to the user's original blockchain network account.</p> <p><img src="http://wherein.mobi/wp-content/uploads/2021/03/tToken-Buning.png" alt="Image text"></p> <p>Figure6, tToken Burning</p> <h2 id="community-token-ctoken-mining-distribution"><a href="#community-token-ctoken-mining-distribution" class="header-anchor">#</a> Community Token(cToken) Mining &amp; Distribution</h2> <p>cToken is the community token specified when any organization or individual creates their own staking economy. A basic distribution strategy is to stake tToken to mine cToken. Nutbox supports a variety of cToken distribution strategies, which users can specify by themselves.</p> <p>In the cToken mining algorithm, we have introduced two main variable factors.</p> <ul><li>shareAccumulate</li></ul> <p>Shared cumulative factors, global variable factors, will be used  for all user reward calculations , represented by pool.shareAcc. The pool corresponds to one type of staking asset. For example, staking tDOT and staking the LP of the tDOT-USDT trading pair correspond to two pools respectively, and the profit sharing ratio of each pool can be configured.</p> <ul><li>debtRewards</li></ul> <p>User private variable factor, which represents the amount of reward that needs to be excluded when calculating the user's reward,  represented by user.debtRewards.</p> <p><img src="http://wherein.mobi/wp-content/uploads/2021/05/peanut12.png" alt="Image text"></p> <p>After setting up the cToken distribution strategy, the users participating in the staking will get the corresponding amount of cToken rewards according to the block.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/nutbox-dao/docs/edit/master/book/technical_paper/ocsp.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/15/2021, 7:48:36 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/technical_paper/background.html" class="prev">
        Background
      </a></span> <span class="next"><a href="/technical_paper/bridge.html">
        Crosschain Bridge
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b699af6d.js" defer></script><script src="/assets/js/2.e08193f9.js" defer></script><script src="/assets/js/37.fdc3a364.js" defer></script>
  </body>
</html>
